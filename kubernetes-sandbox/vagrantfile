nodeCount = 4
image = "generic/ubuntu2204"
ipRangeStart = 1
 
Vagrant.configure("2") do |config|
 
    config.vagrant.plugins = "vagrant-libvirt"
     
    # add ansible deployment key to VMs
    ssh_pub_key = File.readlines("deploy_key.pub").first.strip
    config.vm.provision 'shell', inline: 'mkdir -p /root/.ssh'
    config.vm.provision 'shell', inline: "echo #{ssh_pub_key} >> /root/.ssh/authorized_keys"
 
  # nodes
    if nodeCount > 0
        (1..nodeCount).each do |i|
        config.vm.define "k0s#{i}" do |config|
              config.vm.hostname = "k0s#{i}"
            config.vm.box_check_update = false
            config.vm.box = image
            config.vm.network "private_network", ip: "192.168.7.#{ipRangeStart + i}"
            config.vm.provider :libvirt  do |libvirt|
             libvirt.cpus = 2
             libvirt.memory = "2048"
             
          end
      end
    end
  end
end